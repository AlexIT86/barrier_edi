{% extends 'base/base.html' %}
{% block content %}
<div class="row g-3">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h1 class="h4">Comanda {{ order.order_number }}</h1>
        <div class="row g-2 small text-muted">
          <div class="col-md-3"><strong>Partener:</strong> {{ order.partner.name }}</div>
          <div class="col-md-3"><strong>Data:</strong> {{ order.order_date }}</div>
          <div class="col-md-3"><strong>Livrare:</strong> {{ order.delivery_date }}</div>
          <div class="col-md-3"><strong>Status:</strong> {{ order.get_status_display }}</div>
        </div>
      </div>
      <div class="card-body border-top">
        <h2 class="h6">Poziții</h2>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead>
              <tr>
                <th>Poz.</th>
                <th>Material</th>
                <th>Descriere</th>
                <th>Cant.</th>
                <th>U.M.</th>
                <th>Preț</th>
                <th>Total linie</th>
                <th>Livrat</th>
              </tr>
            </thead>
            <tbody>
              {% for item in order.items.all %}
              <tr>
                <td>{{ item.position }}</td>
                <td>{{ item.material_code }}</td>
                <td>{{ item.material_description }}</td>
                <td>{{ item.quantity_ordered }}</td>
                <td>{{ item.unit_of_measure }}</td>
                <td>{{ item.net_price }}</td>
                <td>{{ item.line_total }}</td>
                <td>{{ item.quantity_delivered }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-body border-top">
        <h2 class="h6">Livrări asociate</h2>
        {% if deliveries %}
          <ul class="list-group list-group-flush">
            {% for d in deliveries %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>{{ d.delivery_number }} — {{ d.delivery_date }} — {{ d.get_status_display }}</span>
                <a class="btn btn-sm btn-outline-primary" href="{% url 'deliveries:delivery_detail' d.pk %}">Detalii</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">Nu există livrări.</p>
        {% endif %}

        <div class="mt-3">
          <div class="progress" role="progressbar" aria-label="Progres livrare" aria-valuenow="{{ delivery_stats.percentage }}" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar">{{ delivery_stats.percentage }}%</div>
          </div>
        </div>
      </div>
      <div class="card-footer d-flex gap-2">
        <a class="btn btn-secondary" href="{% url 'orders:order_list' %}">Înapoi</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}


